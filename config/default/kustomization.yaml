# Look for #[METRICS_PROXY] or #[PROMETHEUS] for controlling components.
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - ../rbac
  - ../addon
  - ../metrics #[METRICS_PROXY]
  - ../prometheus #[PROMETHEUS]
commonLabels:
  app.kubernetes.io/part-of: multicluster-resiliency-addon
# this breaks for devel versions
#buildMetadata:
#  - managedByLabel
labels:
  - pairs:
      app.kubernetes.io/managed-by: kustomize
    includeTemplates: true
replicas:
  - name: manager
    count: 1
replacements:
  - path: replacements/prometheus_service_monitor_selection.yaml #[PROMETHEUS]
patches:
  - path: patches/addon_manager_auth_proxy.yaml #[METRICS_PROXY]
